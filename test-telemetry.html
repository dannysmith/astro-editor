<!DOCTYPE html>
<html>
<head>
    <title>Test Telemetry</title>
</head>
<body>
    <h1>Testing Telemetry Functions</h1>
    <button id="testBtn">Test UUID Creation</button>
    <button id="testSendBtn">Test Send Event</button>
    <pre id="output"></pre>

    <script type="module">
        import { getOrCreateTelemetryUuid, sendTelemetryEvent } from './src/lib/telemetry.ts';
        import { getVersion } from '@tauri-apps/api/app';

        const output = document.getElementById('output');

        document.getElementById('testBtn').addEventListener('click', async () => {
            try {
                output.textContent = 'Testing UUID creation...\n';
                const uuid = await getOrCreateTelemetryUuid();
                output.textContent += `✅ UUID: ${uuid}\n`;
                output.textContent += 'Check ~/Library/Application Support/is.danny.astroeditor/telemetry.json\n';
            } catch (error) {
                output.textContent += `❌ Error: ${error.message}\n`;
                console.error(error);
            }
        });

        document.getElementById('testSendBtn').addEventListener('click', async () => {
            try {
                output.textContent = 'Testing send event...\n';
                const version = await getVersion();
                output.textContent += `Version: ${version}\n`;
                await sendTelemetryEvent(version);
                output.textContent += '✅ Event sent successfully\n';
            } catch (error) {
                output.textContent += `❌ Error: ${error.message}\n`;
                console.error(error);
            }
        });

        // Auto-run on load
        window.addEventListener('DOMContentLoaded', async () => {
            output.textContent = 'Auto-testing on load...\n';
            try {
                const version = await getVersion();
                output.textContent += `Version: ${version}\n`;
                const uuid = await getOrCreateTelemetryUuid();
                output.textContent += `UUID: ${uuid}\n`;
                output.textContent += '✅ All functions work!\n';
            } catch (error) {
                output.textContent += `❌ Error: ${error.message}\n`;
                console.error(error);
            }
        });
    </script>
</body>
</html>
